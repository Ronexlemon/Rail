# -----------------------
# VARIABLES
# -----------------------
GO := go
TOPIC_CMD := ./shared/kafka/topics/cmd/register.go
PRISMA_CMD := github.com/steebchen/prisma-client-go
PRISMA_GENERATE_CMD := github.com/steebchen/prisma-client-go

PROTO_DIR := ./proto
PROTO_OUT := ./proto

# -----------------------
# TARGETS
# -----------------------

.PHONY: all
all: topics dbpush dbgenerate protos

# Kafka topics
.PHONY: topics
topics:
	@echo "ðŸš€ Creating Kafka topics..."
	@$(GO) run $(TOPIC_CMD)
	@echo "âœ… Kafka topics successfully created!"

# Prisma DB push
.PHONY: dbpush
dbpush:
	@echo "ðŸš€ Running Prisma DB push..."
	@$(GO) run $(PRISMA_CMD) db push
	@echo "âœ… Prisma DB push complete!"

# Prisma DB generate
.PHONY: dbgenerate
dbgenerate:
	@echo "ðŸš€ Running Prisma DB generate..."
	@$(GO) run $(PRISMA_GENERATE_CMD) generate
	@echo "âœ… Prisma DB generate complete!"

# Compile protobuf files
.PHONY: protos
protos:
	@echo "ðŸš€ Compiling gRPC proto files..."
	protoc \
		--go_out=. --go_opt=paths=source_relative \
		--go-grpc_out=. --go-grpc_opt=paths=source_relative \
		$(PROTO_DIR)/*.proto
	@echo "âœ… Proto compilation complete!"

# Clean Go cache
.PHONY: clean
clean:
	@echo "ðŸ§¹ Cleaning Go build cache..."
	@$(GO) clean -cache -modcache
	@echo "âœ… Clean complete!"
