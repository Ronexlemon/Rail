# -----------------------
# VARIABLES
# -----------------------
GO := go
TOPIC_CMD := ./shared/kafka/topics/cmd/register.go
PRISMA_CMD := github.com/steebchen/prisma-client-go
PRISMA_GENERATE_CMD := github.com/steebchen/prisma-client-go

PROTO_DIR := ./proto
PROTO_OUT := ./proto

# -----------------------
# TARGETS
# -----------------------

.PHONY: all
all: topics dbpush dbgenerate protos

.PHONY: topics
topics:
	@echo "ðŸš€ Creating Kafka topics..."
	@$(GO) run $(TOPIC_CMD)
	@echo "âœ… Kafka topics successfully created!"

.PHONY: dbpush
dbpush:
	@echo "ðŸš€ Running Prisma DB push..."
	@$(GO) run $(PRISMA_CMD) db push
	@echo "âœ… Prisma DB push complete!"

.PHONY: dbgenerate
dbgenerate:
	@echo "ðŸš€ Running Prisma DB generate..."
	@$(GO) run $(PRISMA_GENERATE_CMD) generate
	@echo "âœ… Prisma DB generate complete!"

.PHONY: protos
protos:
	@echo "ðŸš€ Compiling gRPC proto files..."
	protoc --go_out=$(PROTO_OUT) --go-grpc_out=$(PROTO_OUT) $(PROTO_DIR)/*.proto
	@echo "âœ… Proto compilation complete!"

.PHONY: clean
clean:
	@echo "ðŸ§¹ Cleaning Go build cache..."
	@$(GO) clean -cache -modcache
	@echo "âœ… Clean complete!"
